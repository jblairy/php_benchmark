# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    container.dumper.inline_class_loader: false

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # Auto-tag all Benchmark implementations for autowiring
    _instanceof:
        Jblairy\PhpBenchmark\Domain\Benchmark\Contract\Benchmark:
            tags: ['Jblairy\PhpBenchmark\Domain\Benchmark\Contract\Benchmark']

    # makes classes in src/ available to be used as services
    Jblairy\PhpBenchmark\:
        resource: '../src/'
        exclude:
            - '../src/Builder/'
            - '../src/Domain/'
            - '../src/Kernel.php'

    Jblairy\PhpBenchmark\Domain\Benchmark\Test\:
        resource: '../src/Domain/Benchmark/Test/'

    # Clean Architecture - Port implementations

    # Code Extraction (Port -> Adapter)
    Jblairy\PhpBenchmark\Domain\Benchmark\Port\CodeExtractorPort:
        class: Jblairy\PhpBenchmark\Infrastructure\Execution\CodeExtraction\ReflectionCodeExtractor

    # Benchmark Repository (Port -> Adapter)
    Jblairy\PhpBenchmark\Domain\Benchmark\Port\BenchmarkRepositoryPort:
        class: Jblairy\PhpBenchmark\Infrastructure\Persistence\InMemory\InMemoryBenchmarkRepository

    # Script Execution (Port -> Adapter)
    Jblairy\PhpBenchmark\Domain\Benchmark\Port\ScriptExecutorPort:
        class: Jblairy\PhpBenchmark\Infrastructure\Execution\Docker\DockerScriptExecutor

    # Result Persistence (Port -> Adapter)
    Jblairy\PhpBenchmark\Domain\Benchmark\Port\ResultPersisterPort:
        class: Jblairy\PhpBenchmark\Infrastructure\Persistence\Doctrine\DoctrinePulseResultPersister

    # Benchmark Execution (Port -> Adapter)
    Jblairy\PhpBenchmark\Domain\Benchmark\Port\BenchmarkExecutorPort:
        class: Jblairy\PhpBenchmark\Domain\Benchmark\Service\SingleBenchmarkExecutor

    # Dashboard Repository (Port -> Adapter)
    Jblairy\PhpBenchmark\Domain\Dashboard\Port\DashboardRepositoryPort:
        class: Jblairy\PhpBenchmark\Infrastructure\Persistence\Doctrine\Repository\DoctrineDashboardRepository

    # Application Use Cases with dependencies
    Jblairy\PhpBenchmark\Application\UseCase\AsyncBenchmarkRunner:
        arguments:
            $concurrency: 100

    # Domain Services (need explicit registration since Domain is excluded)
    Jblairy\PhpBenchmark\Domain\Dashboard\Service\StatisticsCalculator: ~
